@using System.Text.RegularExpressions
@using System.Text
@((MarkupString)htmlText)

@code {
    [Parameter]
    public string srcFile { get; set; } = "";
    [Parameter]
    public string pageName { get; set; } = "";

    public string htmlText = "";

    private Regex linkAdder = new(@"(#\w+)");
    private Regex curlCleaner = new(@"(?<=##.*)({)(?=\[)");
    protected override async Task OnInitializedAsync()
    {
        string markdownFile = $"{System.IO.Directory.GetCurrentDirectory()}{@"\wwwroot\content\" + srcFile}";
        var pipeline = new MarkdownPipelineBuilder().UseAdvancedExtensions().Build();
        string rawMarkdown = File.ReadAllText(markdownFile);
        string markdown = "";
        if (pageName is not "") {
            markdown = linkAdder.Replace(rawMarkdown, $"[\\#]({RouteList.Routes[pageName]}$1) {{$1");
            markdown = curlCleaner.Replace(markdown, "");
            htmlText = Markdown.ToHtml(markdown, pipeline);
        } else htmlText = Markdown.ToHtml(rawMarkdown, pipeline);
    }
}